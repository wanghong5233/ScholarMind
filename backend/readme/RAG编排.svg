<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 2477.79052734375 650.1666259765625" style="max-width: 2477.79052734375px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1760276685308-vav8dfbb5"><style>#mermaid-svg-1760276685308-vav8dfbb5{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 .error-icon{fill:#f2dede;}#mermaid-svg-1760276685308-vav8dfbb5 .error-text{fill:#f85149;stroke:#f85149;}#mermaid-svg-1760276685308-vav8dfbb5 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1760276685308-vav8dfbb5 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1760276685308-vav8dfbb5 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1760276685308-vav8dfbb5 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1760276685308-vav8dfbb5 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1760276685308-vav8dfbb5 .marker{fill:#3b3b3b;stroke:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 .marker.cross{stroke:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1760276685308-vav8dfbb5 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 .cluster-label text{fill:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 .cluster-label span,#mermaid-svg-1760276685308-vav8dfbb5 p{color:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 .label text,#mermaid-svg-1760276685308-vav8dfbb5 span,#mermaid-svg-1760276685308-vav8dfbb5 p{fill:#3b3b3b;color:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 .node rect,#mermaid-svg-1760276685308-vav8dfbb5 .node circle,#mermaid-svg-1760276685308-vav8dfbb5 .node ellipse,#mermaid-svg-1760276685308-vav8dfbb5 .node polygon,#mermaid-svg-1760276685308-vav8dfbb5 .node path{fill:#ffffff;stroke:#cecece;stroke-width:1px;}#mermaid-svg-1760276685308-vav8dfbb5 .flowchart-label text{text-anchor:middle;}#mermaid-svg-1760276685308-vav8dfbb5 .node .label{text-align:center;}#mermaid-svg-1760276685308-vav8dfbb5 .node.clickable{cursor:pointer;}#mermaid-svg-1760276685308-vav8dfbb5 .arrowheadPath{fill:#000000;}#mermaid-svg-1760276685308-vav8dfbb5 .edgePath .path{stroke:#3b3b3b;stroke-width:2.0px;}#mermaid-svg-1760276685308-vav8dfbb5 .flowchart-link{stroke:#3b3b3b;fill:none;}#mermaid-svg-1760276685308-vav8dfbb5 .edgeLabel{background-color:#ffffff99;text-align:center;}#mermaid-svg-1760276685308-vav8dfbb5 .edgeLabel rect{opacity:0.5;background-color:#ffffff99;fill:#ffffff99;}#mermaid-svg-1760276685308-vav8dfbb5 .labelBkg{background-color:rgba(255, 255, 255, 0.5);}#mermaid-svg-1760276685308-vav8dfbb5 .cluster rect{fill:#e5ebf1;stroke:#e5e5e5;stroke-width:1px;}#mermaid-svg-1760276685308-vav8dfbb5 .cluster text{fill:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 .cluster span,#mermaid-svg-1760276685308-vav8dfbb5 p{color:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#cccccc;border:1px solid #005fb8;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1760276685308-vav8dfbb5 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#3b3b3b;}#mermaid-svg-1760276685308-vav8dfbb5 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1760276685308-vav8dfbb5_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1760276685308-vav8dfbb5_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1760276685308-vav8dfbb5_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1760276685308-vav8dfbb5_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"><g id="GEN" class="cluster default flowchart-label"><rect height="125.33333206176758" width="2461.7904357910156" y="0" x="0" ry="0" rx="0" style=""/><g transform="translate(1230.8952178955078, 0)" class="cluster-label"><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">生成阶段</tspan></text></g></g><g id="HIST" class="cluster default flowchart-label"><rect height="174.33333110809326" width="646.109001159668" y="145.33333206176758" x="1089.5046005249023" ry="0" rx="0" style=""/><g transform="translate(1412.5591011047363, 145.33333206176758)" class="cluster-label"><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">历史与提示</tspan></text></g></g><g id="RETPHASE" class="cluster default flowchart-label"><rect height="286.16666316986084" width="1372.2858352661133" y="339.66666316986084" x="1089.5046005249023" ry="0" rx="0" style=""/><g transform="translate(1775.647518157959, 339.66666316986084)" class="cluster-label"><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">检索阶段</tspan></text></g></g><g id="RAG" class="cluster default flowchart-label"><rect height="359.66666316986084" width="242.51026916503906" y="151.16666507720947" x="626.8538436889648" ry="0" rx="0" style=""/><g transform="translate(748.1089782714844, 151.16666507720947)" class="cluster-label"><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">RAG 编排 - service.py</tspan></text></g></g><g id="API" class="cluster default flowchart-label"><rect height="135.3333282470703" width="220.61184692382812" y="228.1666669845581" x="356.2419967651367" ry="0" rx="0" style=""/><g transform="translate(466.5479202270508, 228.1666669845581)" class="cluster-label"><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">API</tspan></text></g></g><g id="Client" class="cluster default flowchart-label"><rect height="103.33333206176758" width="869.3641128540039" y="530.8333282470703" x="0" ry="0" rx="0" style=""/><g transform="translate(434.68205642700195, 530.8333282470703)" class="cluster-label"><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">Client</tspan></text></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M242.232,582.5L251.732,582.5C261.233,582.5,280.235,582.5,299.237,582.5C318.239,582.5,337.24,582.5,362.713,540.991C388.186,499.482,420.131,416.464,436.103,374.955L452.075,333.446"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M544.653,323.625L550.02,325.535C555.387,327.445,566.12,331.264,575.654,333.174C585.187,335.083,593.521,335.083,601.854,335.083C610.187,335.083,618.521,335.083,625.971,335.083C633.421,335.083,639.987,335.083,643.271,335.083L646.554,335.083"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" id="L-C-D-0" d="M761.084,351.75L779.131,374.931C797.178,398.111,833.271,444.472,869.663,467.653C906.054,490.833,942.744,490.833,979.434,490.833C1016.124,490.833,1052.815,490.833,1083.969,490.833C1115.123,490.833,1140.742,490.833,1153.551,490.833L1166.361,490.833"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M1361.14,507.089L1381.938,510.657C1402.735,514.226,1444.331,521.363,1475.65,524.931C1506.97,528.5,1528.013,528.5,1538.535,528.5L1549.057,528.5"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-G" id="L-D-G-0" d="M1361.14,475.081L1381.938,471.623C1402.735,468.165,1444.331,461.249,1489.488,457.791C1534.646,454.333,1583.365,454.333,1624.98,454.333C1666.595,454.333,1701.104,454.333,1722.525,454.333C1743.947,454.333,1752.28,454.333,1765.452,457.358C1778.625,460.382,1796.636,466.431,1805.641,469.455L1814.646,472.479"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-G" id="L-E-G-0" d="M1709.813,528.5L1714.113,528.5C1718.413,528.5,1727.013,528.5,1735.48,528.5C1743.947,528.5,1752.28,528.5,1765.711,525.289C1779.142,522.079,1797.671,515.657,1806.936,512.446L1816.2,509.236"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M1891.035,507.5L1905.527,518.611C1920.018,529.722,1949.001,551.944,1966.775,563.056C1984.55,574.167,1991.117,574.167,1994.4,574.167L1997.683,574.167"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-I" id="L-G-I-0" d="M1952.983,490.833L1957.15,490.833C1961.317,490.833,1969.65,490.833,1981.653,490.833C1993.655,490.833,2009.327,490.833,2017.163,490.833L2024.998,490.833"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-P" id="L-I-P-0" d="M2142.095,490.833L2158.815,490.833C2175.534,490.833,2208.973,490.833,2238.049,490.833C2267.125,490.833,2291.837,490.833,2304.194,490.833L2316.55,490.833"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-J" id="L-G-J-0" d="M1901.839,474.167L1914.53,467.667C1927.22,461.167,1952.602,448.167,1973.769,438.873C1994.935,429.579,2011.887,423.992,2020.363,421.199L2028.839,418.405"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-C" id="L-J-C-0" d="M2033.873,394.665L2024.558,393.804C2015.243,392.943,1996.613,391.222,1969.184,390.361C1941.755,389.5,1905.527,389.5,1869.298,389.5C1833.07,389.5,1796.842,389.5,1774.561,389.5C1752.28,389.5,1743.947,389.5,1722.525,389.5C1701.104,389.5,1666.595,389.5,1624.98,389.5C1583.365,389.5,1534.646,389.5,1473.698,389.5C1412.751,389.5,1339.576,389.5,1273.505,389.5C1207.435,389.5,1148.47,389.5,1100.642,369.208C1052.815,348.917,1016.124,308.333,979.434,288.042C942.744,267.75,906.054,267.75,873.274,275.766C840.495,283.781,811.625,299.812,797.191,307.828L782.756,315.844"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-K" id="L-C-K-0" d="M801.059,318.417L812.443,314.833C823.827,311.25,846.596,304.083,876.325,300.5C906.054,296.917,942.744,296.917,979.434,290.764C1016.124,284.611,1052.815,272.306,1074.443,266.153C1096.071,260,1102.638,260,1105.921,260L1109.205,260"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-K LE-L" id="L-K-L-0" d="M1418.296,260L1429.568,260C1440.839,260,1463.383,260,1486.358,257.244C1509.333,254.488,1532.74,248.977,1544.444,246.221L1556.147,243.465"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-L LE-C" id="L-L-C-0" d="M1561.306,208.917L1548.743,205.958C1536.179,203,1511.053,197.083,1461.902,194.125C1412.751,191.167,1339.576,191.167,1273.505,191.167C1207.435,191.167,1148.47,191.167,1100.642,191.167C1052.815,191.167,1016.124,191.167,979.434,191.167C942.744,191.167,906.054,191.167,870.41,211.699C834.765,232.232,800.166,273.298,782.866,293.831L765.566,314.363"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-M" id="L-C-M-0" d="M741.156,318.417L722.106,272.75C703.055,227.083,664.955,135.75,641.738,90.083C618.521,44.417,610.187,44.417,601.854,44.417C593.521,44.417,585.187,44.417,562.636,44.417C540.085,44.417,503.317,44.417,466.548,44.417C429.779,44.417,393.011,44.417,365.125,44.417C337.24,44.417,318.239,44.417,294.968,45.685C271.698,46.952,244.16,49.488,230.391,50.756L216.621,52.024"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-N" id="L-J-N-0" d="M2138.521,399.5L2155.836,399.5C2173.151,399.5,2207.781,399.5,2245.937,347.459C2284.093,295.418,2325.775,191.336,2346.616,139.295L2367.457,87.253"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-M LE-B" id="L-M-B-0" d="M211.344,69.64L225.992,71.519C240.641,73.399,269.939,77.158,294.089,79.037C318.239,80.917,337.24,80.917,361.928,110.506C386.615,140.095,416.988,199.273,432.175,228.862L447.362,258.451"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-F" id="L-B-F-0" d="M544.653,299.669L550.02,299.932C555.387,300.196,566.12,300.723,575.654,347.861C585.187,395,593.521,488.75,601.854,535.625C610.187,582.5,618.521,582.5,633.031,582.5C647.541,582.5,668.228,582.5,678.572,582.5L688.916,582.5"/><path marker-end="url(#mermaid-svg-1760276685308-vav8dfbb5_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-N LE-B" id="L-N-B-0" d="M2315.413,65.667L2303.246,65.667C2291.079,65.667,2266.745,65.667,2228.543,65.667C2190.34,65.667,2138.268,65.667,2094.197,65.667C2050.126,65.667,2014.055,65.667,1977.905,65.667C1941.755,65.667,1905.527,65.667,1869.298,65.667C1833.07,65.667,1796.842,65.667,1774.561,65.667C1752.28,65.667,1743.947,65.667,1722.525,65.667C1701.104,65.667,1666.595,65.667,1624.98,65.667C1583.365,65.667,1534.646,65.667,1473.698,65.667C1412.751,65.667,1339.576,65.667,1273.505,65.667C1207.435,65.667,1148.47,65.667,1100.642,65.667C1052.815,65.667,1016.124,65.667,979.434,65.667C942.744,65.667,906.054,65.667,867.5,65.667C828.946,65.667,788.527,65.667,748.109,65.667C707.691,65.667,667.272,65.667,642.896,65.667C618.521,65.667,610.187,65.667,601.854,101.597C593.521,137.528,585.187,209.389,576.529,245.913C567.872,282.437,558.89,283.625,554.399,284.219L549.908,284.812"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g transform="translate(979.4343566894531, 490.8333282470703)" class="edgeLabel"><g transform="translate(-35.50517272949219, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="71.519775390625" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">2 retrieve</tspan></text></g></g><g transform="translate(1485.9261512756348, 528.4999942779541)" class="edgeLabel"><g transform="translate(-42.63016891479492, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="85.76908874511719" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">Multi-Query</tspan></text></g></g><g transform="translate(1632.0849609375, 454.3333282470703)" class="edgeLabel"><g transform="translate(-18.34634017944336, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="37.06907272338867" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">basic</tspan></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g transform="translate(1632.0849609375, 389.49999618530273)" class="edgeLabel"><g transform="translate(-50.28252029418945, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="100.66932678222656" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">3 返回 Chunks</tspan></text></g></g><g transform="translate(979.4343566894531, 296.91666412353516)" class="edgeLabel"><g transform="translate(-85.07024383544922, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="170.37619018554688" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">4 generate 传入 Chunks</tspan></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g transform="translate(1266.400291442871, 191.16666507720947)" class="edgeLabel"><g transform="translate(-44.32940673828125, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="88.76364135742188" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">返回 Prompt</tspan></text></g></g><g transform="translate(466.5479202270508, 44.41666603088379)" class="edgeLabel"><g transform="translate(-85.30592346191406, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="170.7129364013672" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">5 generate 传入 Prompt</tspan></text></g></g><g transform="translate(2242.4116401672363, 399.49999618530273)" class="edgeLabel"><g transform="translate(-48.00130081176758, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="96.0028305053711" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">用于构建引用</tspan></text></g></g><g transform="translate(299.23678970336914, 80.91666603088379)" class="edgeLabel"><g transform="translate(-32.00520706176758, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="64.45195770263672" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">流式答案</tspan></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g transform="translate(1632.0849609375, 65.66666603088379)" class="edgeLabel"><g transform="translate(-32.00520706176758, -9.166666030883789)" class="label"><rect height="19.35784912109375" width="64.45195770263672" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">引用数据</tspan></text></g></g></g><g class="nodes"><g transform="translate(133.61579132080078, 59.66666603088379)" id="flowchart-M-5341" class="node default default flowchart-label"><rect height="49.33333206176758" width="155.45559692382812" y="-24.66666603088379" x="-77.72779846191406" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -17.16666603088379)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">LLMClient.generate</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">Streaming 或 Once</tspan></text></g></g><g transform="translate(2376.1016883850098, 65.66666603088379)" id="flowchart-N-5342" class="node default default flowchart-label"><rect height="33.33333206176758" width="121.37749481201172" y="-16.66666603088379" x="-60.68874740600586" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">build_citations</tspan></text></g></g><g transform="translate(1266.400291442871, 259.99999713897705)" id="flowchart-K-5339" class="node default default flowchart-label"><rect height="49.33333206176758" width="303.7913818359375" y="-24.66666603088379" x="-151.89569091796875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -17.16666603088379)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">历史压缩与滚动摘要</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">_estimate_tokens / _summarize_history</tspan></text></g></g><g transform="translate(1632.0849609375, 225.58333110809326)" id="flowchart-L-5340" class="node default default flowchart-label"><rect height="33.33333206176758" width="157.05728149414062" y="-16.66666603088379" x="-78.52864074707031" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">PromptBuilder.build</tspan></text></g></g><g transform="translate(1266.400291442871, 490.8333282470703)" id="flowchart-D-5332" class="node default default flowchart-label"><rect height="49.33333206176758" width="189.47900390625" y="-24.66666603088379" x="-94.739501953125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -17.16666603088379)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">策略分发</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">basic / Multi-Query+RRF</tspan></text></g></g><g transform="translate(1632.0849609375, 528.4999942779541)" id="flowchart-E-5333" class="node default default flowchart-label"><rect height="49.33333206176758" width="155.45559692382812" y="-24.66666603088379" x="-77.72779846191406" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -17.16666603088379)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">子查询生成 可选</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">LLMClient.generate</tspan></text></g></g><g transform="translate(1869.2984924316406, 490.8333282470703)" id="flowchart-G-5334" class="node default default flowchart-label"><rect height="33.33333206176758" width="167.36978149414062" y="-16.66666603088379" x="-83.68489074707031" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">ESVectorStore.search</tspan></text></g></g><g transform="translate(2086.19686126709, 574.1666603088379)" id="flowchart-H-5335" class="node default default flowchart-label"><rect height="33.33333206176758" width="166.4269561767578" y="-16.66666603088379" x="-83.2134780883789" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">generate_embedding</tspan></text></g></g><g transform="translate(2086.19686126709, 490.8333282470703)" id="flowchart-I-5336" class="node default default flowchart-label"><rect height="33.33333206176758" width="111.796875" y="-16.66666603088379" x="-55.8984375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">ESConnection</tspan></text></g></g><g transform="translate(2376.1016883850098, 490.8333282470703)" id="flowchart-P-5337" class="node default default flowchart-label"><rect height="33.33333206176758" width="108.50260162353516" y="-16.66666603088379" x="-54.25130081176758" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">Elasticsearch</tspan></text></g></g><g transform="translate(2086.19686126709, 399.49999618530273)" id="flowchart-J-5338" class="node default default flowchart-label"><rect height="49.33333206176758" width="104.6484375" y="-24.66666603088379" x="-52.32421875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -17.16666603088379)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">命中 Chunks</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">含 metadata</tspan></text></g></g><g transform="translate(748.1089782714844, 335.08332920074463)" id="flowchart-C-5328" class="node default default flowchart-label"><rect height="33.33333206176758" width="192.51026916503906" y="-16.66666603088379" x="-96.25513458251953" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">RAGService Orchestrator</tspan></text></g></g><g transform="translate(466.5479202270508, 295.83333110809326)" id="flowchart-B-5327" class="node default default flowchart-label"><rect height="65.33333206176758" width="156.2109375" y="-32.66666603088379" x="-78.10546875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -25.16666603088379)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">session_rt.py /ask</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">1 调用 RAGService</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">6 转发流与合并尾包</tspan></text></g></g><g transform="translate(133.61579132080078, 582.4999942779541)" id="flowchart-A-5325" class="node default default flowchart-label"><rect height="33.33333206176758" width="217.23158264160156" y="-16.66666603088379" x="-108.61579132080078" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">POST /api/sessions/:sid/ask</tspan></text></g></g><g transform="translate(748.1089782714844, 582.4999942779541)" id="flowchart-F-5326" class="node default default flowchart-label"><rect height="33.33333206176758" width="107.78645324707031" y="-16.66666603088379" x="-53.893226623535156" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(0, -9.166666030883789)" style="" class="label"><rect/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">SSE 流式响应</tspan></text></g></g></g></g></g></svg>